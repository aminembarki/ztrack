<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta charset="utf-8" />
        <title>Login</title>

        <meta name="description" content="User login page" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

        <!-- bootstrap & fontawesome -->
        <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
        <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />

        <!-- text fonts -->
        <link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />

        <!-- ace styles -->
        <link rel="stylesheet" href="assets/css/ace.min.css" />

        <!--[if lte IE 9]>
                <link rel="stylesheet" href="assets/css/ace-part2.min.css" />
        <![endif]-->
        <link rel="stylesheet" href="assets/css/ace-rtl.min.css" />

        <link href="build/toastr.css" rel="stylesheet" type="text/css" />

        <!--[if lte IE 9]>
          <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
        <![endif]-->

        <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

        <!--[if lte IE 8]>
        <script src="assets/js/html5shiv.min.js"></script>
        <script src="assets/js/respond.min.js"></script>
        <![endif]-->
    </head>

    <body class="login-layout">
        <div class="main-container">
            <div class="main-content">
                <div class="row">
                    <div class="col-sm-10 col-sm-offset-1">
                        <div class="login-container">
                            <div class="center">
                                <br><br>
                                <img src="assets/images/logos/logo.png">                              
                            </div>
                            <div class="space-6"></div>
                            <div class="position-relative">
                                <div id="login-box" class="login-box visible widget-box no-border">
                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <h4 class="header blue lighter bigger">
                                                <i class="ace-icon fa fa-coffee blue"></i>
                                                Por favor ingrese su información o registrese
                                            </h4>
                                            <div class="space-6"></div>
                                            <form id="form-login" method="post">
                                                <fieldset>
                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="nombre" name="nombre" type="text" class="form-control" placeholder="Nombre de Usuario" />
                                                            <i class="ace-icon fa fa-user"></i>
                                                        </span>
                                                    </label>
                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="password" name="password" type="password" class="form-control" placeholder="Contraseña" />
                                                            <i class="ace-icon fa fa-lock"></i>
                                                        </span>
                                                    </label>
                                                    <div class="space"></div>
                                                    <div class="clearfix">
                                                        <button type="button" onclick="login()" class="width-35 pull-right btn btn-sm btn-primary">
                                                            <i class="ace-icon fa fa-key"></i>
                                                            <span class="bigger-110">Entrar</span>
                                                        </button>
                                                    </div>
                                                    <div class="space-4"></div>
                                                </fieldset>
                                            </form>
                                            <div class="social-or-login center">
                                                <span class="bigger-110">All Rights Reserved</span>
                                            </div>
                                            <div class="space-6"></div>
                                            <div class="social-login center" >
                                                <a class="btn btn-primary" href="http://www.facebook.com/zmodocolombia" target="_blank" title="Síguenos">
                                                    <i class="ace-icon fa fa-facebook"></i>
                                                </a>
                                                <a class="btn btn-danger" href="http://www.zmodocolombia.com/es" target="_blank" title="Mas información">
                                                    <i class="ace-icon fa fa-info"></i>
                                                </a>
                                            </div>
                                        </div><!-- /.widget-main -->
                                        <div class="toolbar clearfix">
                                            <div>
                                                <a href="#" data-target="#forgot-box" class="forgot-password-link">
                                                    <i class="ace-icon fa fa-arrow-left"></i>
                                                    ¿Olvidó su contraseña?
                                                </a>
                                            </div>
                                            <div>
                                                <a href="#" data-target="#signup-box" class="user-signup-link">
                                                    Registrarse
                                                    <i class="ace-icon fa fa-arrow-right"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div><!-- /.widget-body -->
                                </div><!-- /.login-box -->

                                <div id="forgot-box" class="forgot-box widget-box no-border">
                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <h4 class="header red lighter bigger">
                                                <i class="ace-icon fa fa-key"></i>
                                                Recuperar contraseña
                                            </h4>
                                            <div class="space-6"></div>
                                            <p>
                                                Escriba su email para recibir información
                                            </p>
                                            <form>
                                                <fieldset>
                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="emailregistro" name="emailregistro" type="email" class="form-control" placeholder="Email" />
                                                            <i class="ace-icon fa fa-envelope"></i>
                                                        </span>
                                                    </label>
                                                    <div class="clearfix">
                                                        <button type="button" class="width-35 pull-right btn btn-sm btn-danger" onclick="recuperarContrasena()">
                                                            <i class="ace-icon fa fa-arrow-left"></i>
                                                            <span class="bigger-110">Enviar</span>
                                                        </button>
                                                    </div>
                                                </fieldset>
                                            </form>
                                        </div><!-- /.widget-main -->

                                        <div class="toolbar center">
                                            <a href="#" data-target="#login-box" class="back-to-login-link">
                                                Volver a Login
                                                <i class="ace-icon fa fa-arrow-right"></i>
                                            </a>
                                        </div>
                                    </div><!-- /.widget-body -->
                                </div><!-- /.forgot-box -->

                                <div id="signup-box" class="signup-box widget-box no-border">
                                    <div class="widget-body">
                                        <div class="widget-main">
                                            <h4 class="header green lighter bigger">
                                                <i class="ace-icon fa fa-users blue"></i>
                                                Registro de Nueva Empresa
                                            </h4>

                                            <div class="space-6"></div>
                                            <p> Escriba la información a continuación: </p>
                                            <form id="form-registro">
                                                <fieldset>
                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="email" type="email" class="form-control" placeholder="Email" />
                                                            <i class="ace-icon fa fa-envelope"></i>
                                                        </span>
                                                    </label>

                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="empresa" type="text" class="form-control" placeholder="Nombre de Empresa" />
                                                            <i class="ace-icon fa fa-users"></i>
                                                        </span>
                                                    </label>

                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="usuario" type="text" class="form-control" placeholder="Nombre de Usuario" />
                                                            <i class="ace-icon fa fa-user"></i>
                                                        </span>
                                                    </label>

                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="contrasena1" type="password" class="form-control" placeholder="Contrasena" />
                                                            <i class="ace-icon fa fa-lock"></i>
                                                        </span>
                                                    </label>

                                                    <label class="block clearfix">
                                                        <span class="block input-icon input-icon-right">
                                                            <input id="contrasena2" type="password" class="form-control" placeholder="Repetir Contrasena" />
                                                            <i class="ace-icon fa fa-retweet"></i>
                                                        </span>
                                                    </label>
                                                    <div align="center">
                                                        <label class="block">
                                                            <input id="check" type="checkbox" class="ace" />
                                                            <span class="lbl">
                                                                Acepto
                                                                <a href="#">Terminos y Condiciones</a>
                                                            </span>
                                                        </label>
                                                    </div>                                                    
                                                    <div class="space-24"></div>
                                                    <div class="clearfix">
                                                        <button type="reset" class="width-40 pull-left btn btn-sm" onclick="volverToLogin()">
                                                            <i class="ace-icon fa fa-refresh"></i>
                                                            <span class="bigger-110">Cancelar</span>
                                                        </button>
                                                        <button type="button" class="width-50 pull-right btn btn-sm btn-success" onclick="registrar()">
                                                            <span class="bigger-110">Registrar</span>
                                                            <i class="ace-icon fa fa-arrow-right icon-on-right"></i>
                                                        </button>
                                                    </div>
                                                </fieldset>
                                            </form>
                                        </div>

                                        <div class="toolbar center">
                                            <a href="#" data-target="#login-box" class="back-to-login-link">
                                                <i class="ace-icon fa fa-arrow-left"></i>
                                                Volver a Login
                                            </a>
                                        </div>
                                    </div><!-- /.widget-body -->
                                </div><!-- /.signup-box -->
                            </div><!-- /.position-relative -->

                            <!--                            <?php
                                                    if( isset($_SESSION['ERRMSG_ARR']) && is_array($_SESSION['ERRMSG_ARR']) && count($_SESSION['ERRMSG_ARR']) >0 ) {
                                                    echo '<ul class="err">';
                                                    foreach($_SESSION['ERRMSG_ARR'] as $msg) {
                                                            echo '<li>',$msg,'</li>'; 
                                                            }
                                                    echo '</ul>';
                                                    unset($_SESSION['ERRMSG_ARR']);
                                                    }
                                            ?>-->
                        </div>
                    </div><!-- /.col -->
                </div><!-- /.row -->                
            </div><!-- /.main-content -->

        </div><!-- /.main-container -->

        <!-- basic scripts -->

        <!-- ToastrJS -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="build/toastr/toastr.js"></script>

        <!--[if !IE]> -->
        <script src="assets/js/jquery-2.1.4.min.js"></script>

        <!-- <![endif]-->

        <!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
        <script type="text/javascript">
                                                            if ('ontouchstart' in document.documentElement)
                                                                document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
        </script>

        <!-- inline scripts related to this page -->
        <script type="text/javascript">
            window.onload = clear();

            function clear() {
                delete localStorage['ztrack.user_id'];
                delete localStorage['ztrack.username'];
                delete localStorage['ztrack.token'];
                delete localStorage['ztrack.userType'];
                delete localStorage['ztrack.authenticated'];
            }

            jQuery(function ($) {
                $(document).on('click', '.toolbar a[data-target]', function (e) {
                    e.preventDefault();
                    var target = $(this).data('target');
                    $('.widget-box.visible').removeClass('visible');//hide others
                    $(target).addClass('visible');//show target
                });
            });



            //you don't need this, just used for changing background
            jQuery(function ($) {
                $('#btn-login-dark').on('click', function (e) {
                    $('body').attr('class', 'login-layout');
                    $('#id-text2').attr('class', 'white');
                    $('#id-company-text').attr('class', 'blue');

                    e.preventDefault();
                });
                $('#btn-login-light').on('click', function (e) {
                    $('body').attr('class', 'login-layout light-login');
                    $('#id-text2').attr('class', 'grey');
                    $('#id-company-text').attr('class', 'blue');

                    e.preventDefault();
                });
                $('#btn-login-blur').on('click', function (e) {
                    $('body').attr('class', 'login-layout blur-login');
                    $('#id-text2').attr('class', 'white');
                    $('#id-company-text').attr('class', 'light-blue');

                    e.preventDefault();
                });

            });

            //          Function para mostrar el modal del error
            $("#id-btn-dialog2").on('click', function (e) {
                e.preventDefault();
                $("#dialog-confirm").removeClass('hide').dialog({
                    resizable: false,
                    width: '320',
                    modal: true,
                    title: "<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-exclamation-triangle red'></i> Error de inicio de sesión</h4></div>",
                    title_html: true,
                    buttons: [
                        {
                            html: "<i class='ace-icon fa fa-trash-o bigger-110'></i>&nbsp; Intentar de nuevo",
                            "class": "btn btn-danger btn-minier",
                            click: function () {
                                $(this).dialog("close");
                            }
                        },
                        {
                            html: "<i class='ace-icon fa fa-times bigger-110'></i>&nbsp; Cancelar",
                            "class": "btn btn-minier",
                            click: function () {
                                $(this).dialog("close");
                            }
                        }
                    ]
                });
            }
            );


            function volverToLogin() {
                window.location = "login.html";
            }


            function login() {
                var nombre = document.getElementById("nombre").value;
                var password = document.getElementById("password").value;
                $.ajax({
                    url: 'php/login.php',
                    data: {nombre: nombre, password: password},
                    dataType: "json",
                    type: 'POST',
                    success: function (result) {
                        if (result[0]["success"] === 'false') {
                            toastrMsj(result[0]["value"], "Error", "error");
                        } else
                        {
                            sessionStorage.setItem('sessionId', result[0]["sessionId"]);
                            save(result[0]); // Creo Session                            
                        }
                    }
                });
            }
            ;

            this.save = function (data) {
                localStorage['ztrack.user_id'] = data.userId;
                localStorage['ztrack.username'] = data.username;
                localStorage['ztrack.token'] = data.token;
                localStorage['ztrack.authenticated'] = true;
                window.location = 'index.html';
            };


            function registrar() {
                var email = document.getElementById("email").value;
                var empresa = document.getElementById("empresa").value;
                var username = document.getElementById("usuario").value;
                var pass1 = document.getElementById("contrasena1").value;
                var pass2 = document.getElementById("contrasena2").value;
                var chk = document.getElementById("check").checked;
                if (pass1.toString() !== pass2.toString()) {
                    toastrMsj("Las contraseñas no coinciden. Intente de nuevo", "Error", "error");
                    return;
                }
                if (chk) {
                    toastrMsj("Se está realizando la peticion. Espere un momento.", "Info", "warning");
                    $.ajax({
                        url: 'php/register.php',
                        data: {email: email, empresa: empresa, username: username, pass1: pass1, pass2: pass2, chk: chk},
                        dataType: "json",
                        type: 'GET',
                        success: function (result) {
                            if (result[0]["success"] === 'true') {
                                toastrMsj(result[0]["value"], "Éxito", "success");
                                redirToLogin();
                            } else
                            {
                                toastrMsj(result[0]["value"], "Error", "error");
                            }
                        }
                    });

                } else {
                    toastrMsj("Debe aceptar los terminos y condiciones para continuar", "Error", "error");
                    return;
                }

            }

            function redirToLogin() {
                setTimeout("location.href='login.html'", 5500);
            }


            function recuperarContrasena() {
                var email = document.getElementById("emailregistro").value;
                toastrMsj("Se está generando una nueva contrasena. Revise su correo.", "Info", "warning");
                $.ajax({
                    url: 'php/newpassword.php',
                    data: {email: email},
                    dataType: "json",
                    type: 'POST',
                    success: function (result) {
                        if (result[0]["success"] === 'false') {
                            toastrMsj(result[0]["value"], "Error", "error");
                        } else
                        {
                            toastrMsj(result[0]["value"], "Éxito", "success");
                            redirToLogin();
                        }
                    }
                });

            }

            function toastrMsj(mensaje, titulo, $type) {
                var msg = mensaje;
                var title = titulo;
                toastr.options = {
                    debug: false,
                    closeButton: $('#closeButton').prop('checked'),
                    newestOnTop: $('#newestOnTop').prop('checked'),
                    progressBar: $('#progressBar').prop('checked'),
                    rtl: $('#rtl').prop('checked'),
                    positionClass: $('#positionGroup input:radio:checked').val() || 'toast-top-right',
                    preventDuplicates: $('#preventDuplicates').prop('checked'),
                    onclick: null,
                    fadeIn: 200,
                    fadeOut: 100,
                    timeOut: 3000,
                    extendedTimeOut: 3000
                };
                toastr[$type](msg, title);
            }

        </script>
    </body>
</html>
